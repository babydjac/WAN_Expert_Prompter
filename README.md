# üé¨ WAN 2.2 Expert Prompter - Enhanced Edition

**Transform vague concepts into cinematic masterpieces with AI-powered WAN 2.2 video generation prompts.**

Professional-grade prompt optimization system powered by Gemini AI, featuring dynamic UI enhancements, creative variety algorithms, and reference image integration. Designed specifically for WAN 2.2 MoE architecture with 80-120 word optimization.

---

## ‚ú® What Makes This Special

### üéØ **Creative Intelligence**
- **Anti-Formulaic System**: Advanced algorithms prevent repetitive prompts
- **Filmmaker Personas**: 5 rotating creative approaches for varied output
- **Style-Adaptive Enhancement**: Context-aware creative direction based on scene type
- **Visual Poetry Engine**: Rich vocabulary palette with 50+ cinematographic terms

### üñºÔ∏è **Reference Image Integration**
- **Upload & Preview System**: Drag-and-drop image upload with instant preview
- **AI Vision Analysis**: Gemini analyzes uploaded images for contextual prompt enhancement  
- **Smart Toggle Controls**: Enable/disable image usage without re-uploading
- **Visual Preview Controls**: Hide, collapse, expand with preserved image data

### üé® **Dynamic Enhanced UI**
- **Animated Visual Effects**: Glowing borders, gradient backgrounds, smooth transitions
- **NSFW Mode Switching**: Complete theme transformation (cyan‚Üíred) with visual indicators
- **Interactive Controls**: Upload buttons, preview toggles, collapse/expand functionality
- **Real-time Feedback**: Live word count, validation metrics, status indicators

---

## üöÄ Key Features

### Core Capabilities
- ‚úÖ **Expert Prompt Generation**: Transform basic concepts into professional WAN 2.2 prompts
- ‚úÖ **MoE Architecture Optimization**: Perfect 80-120 word structure for expert coordination
- ‚úÖ **Sequential Structure**: Opening Scene ‚Üí Camera Motion ‚Üí Reveal/Payoff methodology
- ‚úÖ **Creative Variety System**: Unique prompts every time, even with identical inputs
- ‚úÖ **Multi-Model Support**: Optimized for T2V-A14B, I2V-A14B, and TI2V-5B variants

### Smart Features
- üé≠ **5 Cinematic Styles**: Dramatic, Cinematic, Commercial, Realistic, Stylized
- üé¨ **4 Scene Types**: Static Scene, Character Focus, Action Sequence, Atmospheric
- üì∑ **Reference Image Support**: Visual context integration via Gemini vision
- üîÑ **Real-time Validation**: Word count, structure, and quality analysis
- üé® **Dynamic Theming**: Visual mode switching for Normal/NSFW content

### Enhanced Controls
- üì§ **Image Upload System**: Professional drag-and-drop interface
- üëÅÔ∏è **Preview Management**: Hide/show, collapse/expand, enable/disable toggles
- ‚ö° **Live Updates**: Real-time prompt analysis and visual feedback
- üéØ **Glowing Word Count**: Dynamic color-coded word count display

---

## üìã Requirements

- **ComfyUI**: Latest version recommended
- **comfy_api_nodes**: Required for Gemini API integration
- **API Credentials**: Valid Comfy.org account with API access
- **Modern Browser**: Chrome 90+, Firefox 88+, or Safari 14+

---

## üîß Installation

1. **Clone/Download** this repository to `ComfyUI/custom_nodes/WAN_Expert_Prompter`
2. **Install Dependencies**: Ensure `comfy_api_nodes` is installed
3. **Restart ComfyUI** to load the custom node
4. **Configure API**: Set up Comfy.org API credentials in ComfyUI settings
5. **Verify Installation**: Look for "üé¨ WAN 2.2 Expert Prompter" in node menu

---

## üéÆ How to Use

### Basic Workflow
1. **Add Node**: Find "üé¨ WAN 2.2 Expert Prompter" in `video/WAN 2.2` category
2. **Enter Subject**: Describe your video concept (e.g., "a warrior in a moonlit forest")
3. **Choose Settings**: Select WAN model, cinematic style, and scene type
4. **Optional**: Upload reference image, add custom instructions
5. **Generate**: Execute to get your optimized WAN 2.2 prompt
6. **Connect**: Use the optimized prompt output for your video generation

### Input Parameters

#### **Required Settings**
- **User Subject**: Your basic video concept description
- **WAN Model**: 
  - `T2V-A14B`: Most capable, complex scenes
  - `I2V-A14B`: Image-to-video generation  
  - `TI2V-5B`: Lightweight, faster processing
- **Cinematic Style**: Overall aesthetic direction
- **Scene Type**: Optimizes camera work and pacing
- **Gemini Model**: Pro for creativity, Flash for speed

#### **Optional Enhancements**
- **Reference Image**: Upload via the integrated button
- **Custom Instructions**: Specific requirements or constraints
- **NSFW Mode**: Enable for adult content (visual theme changes)

### Enhanced UI Controls

#### **Image Management**
1. **üì∑ Upload Reference Image**: Click to select image file
2. **‚úÖ Use Reference Image** / **‚ùå Not Using Reference**: Toggle AI usage
3. **üëÅÔ∏è Hide Preview** / **üëÅÔ∏è Show Preview**: Control visibility
4. **‚àí Collapse** / **+ Expand**: Minimize preview to save space

#### **Visual Feedback**
- **Glowing Word Count**: Bottom-right corner, color-coded for optimal range
- **Dynamic Theming**: Complete color scheme changes based on NSFW mode
- **Status Indicators**: Real-time mode and processing status

---

## üé® Creative System Details

### Filmmaker Personas (Rotates Randomly)
1. **Visionary Cinematographer**: Poet's soul with painter's eye
2. **Legendary Director**: Master of iconic visual moments
3. **Cinematic Alchemist**: Transforms concepts into visual gold
4. **Visual Storyteller**: Fluent in light, shadow, and motion
5. **Emotion Master**: Finds extraordinary in every frame

### Style-Specific Inspiration
- **Dramatic**: Blade Runner 2049, Mad Max Fury Road - high contrast, bold movements
- **Cinematic**: Terrence Malick, Roger Deakins - poetic, flowing, naturalistic
- **Commercial**: Apple ads, luxury films - clean, aspirational, precise
- **Realistic**: Documentary style, handheld intimacy, natural lighting
- **Stylized**: Wes Anderson symmetry, Denis Villeneuve scale, Wong Kar-wai color

### Rich Vocabulary Palette
- **Camera Movement**: gliding crane sweep, vertiginous tilt, spiraling orbit, whip pan, floating steadicam flow
- **Lighting Artistry**: chiaroscuro contrast, neon-soaked shadows, ethereal backlighting, practical source motivation
- **Visual Poetry**: gossamer mist, liquid mercury textures, silk-smooth motion blur, painterly bokeh
- **Composition**: rule of thirds tension, negative space breathing, foreground layering, depth compression

---

## üí´ Example Transformations

### Input: "A warrior in a moonlit forest"

**Standard Output:**
> A lone warrior draws his sword in a moonlit clearing, spurs clicking rhythmically on weathered wooden planks. Camera starts low angle behind worn leather boots, slowly cranes up to reveal determined eyes beneath a weathered hat brim. Ancient trees sway in midnight wind, fog swirls at ground level. Camera pulls back slowly revealing the epic scale, blue-silver color palette, haunting atmosphere. Anamorphic lens flare, high contrast cinematic cinematography, teal-and-orange color grade.

**Enhanced Creative Output:**
> Weathered blade gleams like liquid mercury in cathedral moonbeams filtering through ancient oak canopy. Camera drifts through gossamer mist at forest floor level, rack focus pull from gnarled roots to battle-scarred gauntlets gripping sword hilt. Spiraling crane sweep reveals the warrior's silhouette against towering trees, their synchronized shadows creating a living mandala of darkness. Ethereal backlighting transforms falling leaves into dancing spirits, while chiaroscuro contrast sculpts every detail into painterly perfection. The forest breathes with him.

---

## üé≠ Visual Themes

### Normal Mode Theme
- **Primary**: Electric Cyan (#00E5FF) - Clean, professional
- **Secondary**: Sunset Orange (#FF6B35) - Warm accents
- **Background**: Deep Teal (#0B1F2A) - Sophisticated depth
- **Accent**: Electric Purple (#7C4DFF) - Creative energy

### NSFW Mode Theme  
- **Primary**: Hot Pink (#FF1744) - Bold, attention-grabbing
- **Secondary**: Deep Pink (#E91E63) - Complementary intensity
- **Background**: Dark Purple (#1A0B1E) - Mature, sophisticated
- **Accent**: Accent Pink (#FF4081) - Playful highlights

---

## üîß Technical Specifications

### WAN 2.2 Optimization
- **Word Count**: Exactly 80-120 words for MoE architecture
- **Sequential Flow**: Optimized for high-noise ‚Üí low-noise expert handoff
- **Cinematographic Vocabulary**: Professional terminology for consistent results
- **Style-Specific Enhancement**: Tailored camera work and lighting

### Validation System
- ‚úÖ Word count validation (80-120 range)
- ‚úÖ Camera movement detection  
- ‚úÖ Visual element analysis
- ‚úÖ Sequential structure verification
- ‚úÖ Creative variety scoring

### Performance Features
- **Hardware Acceleration**: GPU-accelerated CSS animations
- **Efficient Rendering**: Minimal DOM manipulation
- **Smart Updates**: Only re-renders changed elements
- **Memory Management**: Proper cleanup of resources

---

## üêõ Troubleshooting

### Common Issues

**"Gemini API not available"**
- Install `comfy_api_nodes` via ComfyUI Manager
- Verify API credentials in ComfyUI settings

**Image not referenced in prompts**
- Check console logs for "üñºÔ∏è Using reference image" message
- Ensure "Use Reference Image" toggle is enabled
- Verify image uploaded successfully

**Upload button not appearing**
- Restart ComfyUI after installation
- Clear browser cache (Ctrl+F5)
- Check browser console for JavaScript errors

**Collapse/expand issues**
- Use browser dev tools to check for console errors
- Verify original image data is preserved
- Try re-uploading image if preview disappears

### Debug Information
The system provides comprehensive logging:
- **Frontend**: Image upload, execution hooks, UI state changes
- **Backend**: Parameter reception, image data processing, prompt generation
- **Console**: Real-time status updates and error reporting

---

## üîÆ Advanced Usage

### Custom Instructions Examples
```
"Include product placement for luxury coffee brand"
"Ensure composition works for vertical 9:16 format"
"Focus on macro lens details and surface textures"
"Create montage sequence with quick cuts"
"Emphasize practical lighting effects only"
```

### Reference Image Tips
- **High Quality**: Use 1024px+ images for best AI analysis
- **Clear Subjects**: Avoid cluttered compositions
- **Lighting Reference**: Images with interesting lighting work best
- **Style References**: Architectural, fashion, or nature photography
- **Color Palettes**: The AI will extract and reference color schemes

### Creative Workflow
1. **Start Broad**: Begin with simple subject concepts
2. **Layer Details**: Use custom instructions for specificity  
3. **Visual Context**: Add reference images for style guidance
4. **Iterate**: Generate multiple variations by re-running
5. **Refine**: Adjust settings based on results

---

## üèóÔ∏è File Structure

```
WAN_Expert_Prompter/
‚îú‚îÄ‚îÄ README.md                           # This comprehensive guide
‚îú‚îÄ‚îÄ __init__.py                         # Module configuration
‚îú‚îÄ‚îÄ wan_prompter.py                     # Enhanced Python backend
‚îî‚îÄ‚îÄ web/extensions/
    ‚îú‚îÄ‚îÄ wan.expert.enhanced.js          # Main enhanced UI system
    ‚îú‚îÄ‚îÄ wan.expert.preview.js           # Preview panel functionality  
    ‚îî‚îÄ‚îÄ wan.expert.color.js             # Basic color enhancements
```

---

## üéØ What's Next

### Planned Enhancements
- **3D Visual Effects**: WebGL-based node rendering
- **Advanced Image Analysis**: Multi-image reference support
- **Collaborative Features**: Multi-user prompt collaboration
- **Template System**: Save and share custom enhancement templates
- **Voice Integration**: Audio input for concept description
- **AI-Powered Suggestions**: Smart recommendations based on patterns

### Contributing
This project is actively maintained. Feature requests, bug reports, and contributions are welcome through GitHub issues and pull requests.

---

## üìú Based on WAN 2.2 Documentation

This node implements the complete **WAN 2.2 Master Prompter Training Manual** methodology with significant creative enhancements:

- ‚úÖ Mixture-of-Experts architecture understanding
- ‚úÖ Professional cinematographic vocabulary  
- ‚úÖ Sequential prompt structure optimization
- ‚úÖ Style-specific enhancement patterns
- ‚úÖ Quality validation frameworks
- ‚ú® **NEW**: Creative variety algorithms
- ‚ú® **NEW**: Visual reference integration
- ‚ú® **NEW**: Dynamic UI enhancement system

---

**Created with professional expertise in WAN 2.2 video generation, AI prompt engineering, and modern UI/UX design.**

*Transform your creative vision into cinematic reality with the most advanced WAN 2.2 prompt generation system available.*